<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="John Doe">
  
  
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">Hexo</a></h1>
    <p><a href="/"></a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content">




  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/01/19/using-slidingtablayout/">
  <time datetime="2015-01-19T07:00:00.000Z">
    2015-01-19
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/01/19/using-slidingtablayout/">使用SlidingTabLayout和ViewPager打造Tabs布局</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>将官方的<a href="https://github.com/google/iosched/blob/master/android/src/main/java/com/google/samples/apps/iosched/ui/widget/SlidingTabLayout.java"><strong>SlidingTabLayout.java</strong></a>和<a href="https://github.com/google/iosched/blob/master/android/src/main/java/com/google/samples/apps/iosched/ui/widget/SlidingTabStrip.java"><strong>SlidingTabStrip.java</strong></a>拷到自己的项目里面。</p>
<p>修改布局</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">       <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">       <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">       <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="title">cn.treize.paperpomodoro.view.SlidingTabLayout</span></span><br><span class="line">           <span class="attribute">android:id</span>=<span class="value">"@+id/tabs"</span></span><br><span class="line">           <span class="attribute">android:background</span>=<span class="value">"@color/color_primary"</span></span><br><span class="line">           <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">           <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">       <span class="tag">&lt;<span class="title">android.support.v4.view.ViewPager</span></span><br><span class="line">           <span class="attribute">android:id</span>=<span class="value">"@+id/pager"</span></span><br><span class="line">           <span class="attribute">android:layout_weight</span>=<span class="value">"1"</span></span><br><span class="line">           <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">           <span class="attribute">android:layout_height</span>=<span class="value">"0dp"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改MainActivity.java</p>
    
  </div>
  <footer class="end-sep">
    
      
        <div class="alignleft">
          <a href="/2015/01/19/using-slidingtablayout/#more" class="more-link">阅读全文</a>
        </div>
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/01/08/recyclerview-and-cardview/">
  <time datetime="2015-01-08T07:00:00.000Z">
    2015-01-08
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/01/08/recyclerview-and-cardview/">RecyclerView和CardView使用</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h3 id="介绍">介绍</h3><p><strong>RecyclerView</strong>是android-support-v7-21版本中新增的一个Widgets,官方介绍 RecyclerView 是 ListView 的升级版本，更加先进和灵活。</p>
<p><strong>CardView</strong>则是Google提供的一个卡片式视图组件</p>
<p>这个例子将展示一个使用RecyclerView展示多个显示联系人资料的CardView的例子。</p>
<h3 id="布局">布局</h3><p>为了使用RecyclerView和CardView，需要导入support-v7中的两个包。在Android Studio上面很容易。</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:recyclerview-v7:21.0.3'</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:cardview-v7:21.0.3'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RecyclerView和ListView非常类似，我们可以用同样的方式放入布局里面。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- activity_main.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">RelativeLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">android.support.v7.widget.RecyclerView</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/cardList"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这是一个卡片布局，包含了几个TextView用来展示用户资料</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> <span class="comment">&lt;!-- card_item.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.CardView</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:id</span>=<span class="value">"@+id/card_view"</span></span><br><span class="line">    <span class="attribute">card_view:cardCornerRadius</span>=<span class="value">"4dp"</span></span><br><span class="line">    <span class="attribute">android:layout_margin</span>=<span class="value">"5dp"</span></span><br><span class="line">    <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:card_view</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">RelativeLayout</span> <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/title"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"20dp"</span></span><br><span class="line">            <span class="attribute">android:background</span>=<span class="value">"@color/bkg_card"</span></span><br><span class="line">            <span class="attribute">android:text</span>=<span class="value">"contact det"</span></span><br><span class="line">            <span class="attribute">android:gravity</span>=<span class="value">"center_vertical"</span></span><br><span class="line">            <span class="attribute">android:textColor</span>=<span class="value">"@android:color/white"</span></span><br><span class="line">            <span class="attribute">android:textSize</span>=<span class="value">"14dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/txtName"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:text</span>=<span class="value">"Name"</span></span><br><span class="line">            <span class="attribute">android:gravity</span>=<span class="value">"center_vertical"</span></span><br><span class="line">            <span class="attribute">android:textSize</span>=<span class="value">"10dp"</span></span><br><span class="line">            <span class="attribute">android:layout_below</span>=<span class="value">"@id/title"</span></span><br><span class="line">            <span class="attribute">android:layout_marginTop</span>=<span class="value">"10dp"</span></span><br><span class="line">            <span class="attribute">android:layout_marginLeft</span>=<span class="value">"5dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/txtSurname"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:text</span>=<span class="value">"Surname"</span></span><br><span class="line">            <span class="attribute">android:gravity</span>=<span class="value">"center_vertical"</span></span><br><span class="line">            <span class="attribute">android:textSize</span>=<span class="value">"10dp"</span></span><br><span class="line">            <span class="attribute">android:layout_below</span>=<span class="value">"@id/txtName"</span></span><br><span class="line">            <span class="attribute">android:layout_marginTop</span>=<span class="value">"10dp"</span></span><br><span class="line">            <span class="attribute">android:layout_marginLeft</span>=<span class="value">"5dp"</span></span><br><span class="line">            /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/txtEmail"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:text</span>=<span class="value">"Email"</span></span><br><span class="line">            <span class="attribute">android:textSize</span>=<span class="value">"10dp"</span></span><br><span class="line">            <span class="attribute">android:layout_marginTop</span>=<span class="value">"10dp"</span></span><br><span class="line">            <span class="attribute">android:layout_alignParentRight</span>=<span class="value">"true"</span></span><br><span class="line">            <span class="attribute">android:layout_marginRight</span>=<span class="value">"150dp"</span></span><br><span class="line">            <span class="attribute">android:layout_alignBaseline</span>=<span class="value">"@id/txtName"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/txtAdd"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">            <span class="attribute">android:text</span>=<span class="value">"Address"</span></span><br><span class="line">            <span class="attribute">android:textSize</span>=<span class="value">"10dp"</span></span><br><span class="line">            <span class="attribute">android:layout_alignStart</span>=<span class="value">"@id/txtEmail"</span></span><br><span class="line">            <span class="attribute">android:layout_alignBaseline</span>=<span class="value">"@id/txtSurname"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">RelativeLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.CardView</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="代码">代码</h3><p>我们先来建个联系人类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.treize.recyclerviewandcardview;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by treize on 15-1-7.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContactInfo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line">    <span class="keyword">protected</span> String surname;</span><br><span class="line">    <span class="keyword">protected</span> String email;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME_PREFIX = <span class="string">"Name_"</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String SURNAME_PREFIX = <span class="string">"Surname_"</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String EMAIL_PREFIX = <span class="string">"Email_"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义的RecyclerView.Adapter</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.treize.recyclerviewandcardview;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by treize on 15-1-7.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContactAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">ContactAdapter</span>.<span class="title">ContactViewHolder</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;ContactInfo&gt; contactList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ContactAdapter</span><span class="params">(List&lt;ContactInfo&gt; contactList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.contactList = contactList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ContactViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">        View itemView = LayoutInflater.from(parent.getContext())</span><br><span class="line">                .inflate(R.layout.card_item, parent ,<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ContactViewHolder(itemView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ContactViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        ContactInfo ci = contactList.get(position);</span><br><span class="line">        holder.vName.setText(ci.name);</span><br><span class="line">        holder.vEmail.setText(ci.email);</span><br><span class="line">        holder.vSurname.setText(ci.surname);</span><br><span class="line">        holder.vTitle.setText(ci.name + <span class="string">" "</span> + ci.surname);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> contactList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写自定义的ViewHolder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ContactViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> TextView vName;</span><br><span class="line">        <span class="keyword">protected</span> TextView vSurname;</span><br><span class="line">        <span class="keyword">protected</span> TextView vEmail;</span><br><span class="line">        <span class="keyword">protected</span> TextView vTitle;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ContactViewHolder</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(v);</span><br><span class="line">            vName = (TextView) v.findViewById(R.id.txtName);</span><br><span class="line">            vSurname = (TextView) v.findViewById(R.id.txtSurname);</span><br><span class="line">            vEmail = (TextView) v.findViewById(R.id.txtEmail);</span><br><span class="line">            vTitle = (TextView) v.findViewById(R.id.title);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MainAcitvity.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.treize.recyclerviewandcardview;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.ActionBarActivity;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.LinearLayoutManager;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        RecyclerView recyclerView = (RecyclerView) findViewById(R.id.cardList);</span><br><span class="line">        recyclerView.setHasFixedSize(<span class="keyword">true</span>);</span><br><span class="line">        LinearLayoutManager layoutManager = <span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>);</span><br><span class="line">        layoutManager.setOrientation(LinearLayoutManager.VERTICAL);</span><br><span class="line">        recyclerView.setLayoutManager(layoutManager);</span><br><span class="line"></span><br><span class="line">        ContactAdapter adapter = <span class="keyword">new</span> ContactAdapter(createList(<span class="number">30</span>));</span><br><span class="line">        recyclerView.setAdapter(adapter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">        <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">        <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">        <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ContactInfo&gt; <span class="title">createList</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">        List&lt;ContactInfo&gt; contactList = <span class="keyword">new</span> ArrayList&lt;ContactInfo&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;= size; i++)&#123;</span><br><span class="line">            ContactInfo ci = <span class="keyword">new</span> ContactInfo();</span><br><span class="line">            ci.name = ContactInfo.NAME_PREFIX + i;</span><br><span class="line">            ci.surname = ContactInfo.SURNAME_PREFIX +i;</span><br><span class="line">            ci.email = ContactInfo.EMAIL_PREFIX +i;</span><br><span class="line"></span><br><span class="line">            contactList.add(ci);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> contactList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下</p>
<p><img src="http://treizeor.qiniudn.com/img/recyclerview_cardview.png" alt=""></p>
<h3 id="OnItemClick方法">OnItemClick方法</h3><p>我们发现RecyclerView没有OnItemClick之类的方法。那怎么实现呢，有很多种方法。这里用的是来说<a href="http://stackoverflow.com/questions/24471109/recyclerview-onclick" target="_blank" rel="external"><strong>StackOverFlow</strong></a>的一个方法，看别人的回复说有延迟，但是我在模拟器中使用没发现。</p>
<p>他的使用方法很简单：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RecyclerView recyclerView = findViewById(R.id.recycler);</span><br><span class="line">recyclerView.addOnItemTouchListener(<span class="keyword">new</span> RecyclerItemClickListener(getApplicationContext(),<span class="keyword">new</span> RecyclerItemClickListener.OnItemClickListener()&#123;</span><br><span class="line"></span><br><span class="line">          <span class="annotation">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(View view, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">              ((TextView)view.findViewById(R.id.title)).setText(<span class="string">"onClick~~~~~~~~~~~~~~~"</span>);</span><br><span class="line">              Toast.makeText(getApplicationContext(),<span class="string">"this is "</span> + (position+<span class="number">1</span>) +<span class="string">" item"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;));</span><br></pre></td></tr></table></figure>
<p>RecyclerItemClickListener的实现:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.treize.recyclerviewandcardview;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> android.view.GestureDetector;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by treize on 15-1-9.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecyclerItemClickListener</span> <span class="keyword">implements</span> <span class="title">RecyclerView</span>.<span class="title">OnItemTouchListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> OnItemClickListener mListener;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnItemClickListener</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(View view, <span class="keyword">int</span> position)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    GestureDetector mGestureDetector;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RecyclerItemClickListener</span><span class="params">(Context context, OnItemClickListener mListener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mListener = mListener;</span><br><span class="line">        mGestureDetector = <span class="keyword">new</span> GestureDetector(context, <span class="keyword">new</span> GestureDetector.SimpleOnGestureListener()&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onSingleTapUp</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(RecyclerView rv, MotionEvent e)</span> </span>&#123;</span><br><span class="line">        View childView = rv.findChildViewUnder(e.getX(), e.getY());</span><br><span class="line">        <span class="keyword">if</span> (childView != <span class="keyword">null</span> &amp;&amp; mListener !=<span class="keyword">null</span> &amp;&amp; mGestureDetector.onTouchEvent(e)) &#123;</span><br><span class="line">            mListener.onItemClick(childView,rv.getChildPosition(childView));</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTouchEvent</span><span class="params">(RecyclerView rv, MotionEvent e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下:</p>
<p><img src="http://treizeor.qiniudn.com/img/recyclerview_onitemclick.png" alt=""></p>
<p>本文中的代码可以在<a href="https://github.com/treizeor/material_test_project/tree/master/RecyclerViewAndCardView" target="_blank" rel="external"><strong>GitHub</strong></a>中找到。</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/01/05/building-data-driven-hierarchical-views/">
  <time datetime="2015-01-05T07:00:00.000Z">
    2015-01-05
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/01/05/building-data-driven-hierarchical-views/">建立数据驱动的分层视图(翻译)</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>应用程序中有一种很常见的情况是由事件数据驱动UI的显示。本教程中将展示一个我几乎每天工作中都用到的非常有用的技术，这是此前一个非常有才华的工程师教给我的。用于建立多个自定义的视图并用于不同的布局，然后将数据更新到每个布局的一个容器视图里。本教程的所有代码都可以在<a href="https://github.com/PaulTR/AndroidDemoProjects/tree/master/EventDrivenHierarchicalViews" target="_blank" rel="external"><em>GitHub</em></a>上面找到。</p>
<p>英文好且有梯子的请戳<a href="http://ptrprograms.blogspot.com/2014/12/building-data-driven-hierarchical-views.html" target="_blank" rel="external"><em>这里</em></a>看原文。</p>
<p>在这个例子中我们要做的第一件事就是创建一个用于更新视图的接口。这个接口只有一个<code>update</code>方法，用于更新视图数据。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Updateable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">( Weather weather )</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来，我们将实现一个简单的数据模型，容纳我们用于驱动视图的所有数据。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Weather</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> temperature;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> windSpeed;</span><br><span class="line">    <span class="keyword">private</span> WindDirection windDirection;</span><br><span class="line">    <span class="keyword">private</span> WeatherCondition condition;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Weather</span><span class="params">( <span class="keyword">int</span> temperature, <span class="keyword">int</span> windSpeed, WindDirection windDirection, WeatherCondition condition )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.temperature = temperature;</span><br><span class="line">        <span class="keyword">this</span>.windSpeed = windSpeed;</span><br><span class="line">        <span class="keyword">this</span>.windDirection = windDirection;</span><br><span class="line">        <span class="keyword">this</span>.condition = condition;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTemperature</span><span class="params">( <span class="keyword">int</span> temperature )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.temperature = temperature;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTemperature</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> temperature;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><code>WindDirection</code>和<code>WeatherConditon</code>只是一些像这样的枚举类型：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> WeatherCondition &#123;</span><br><span class="line">    RAIN,</span><br><span class="line">    SNOW,</span><br><span class="line">    LIGHTNING,</span><br><span class="line">    SUN,</span><br><span class="line">    CLOUDY,</span><br><span class="line">    FOG</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们已经创建好了数据模型和接口。接下来开始为我们的项目创建<code>updateable</code>视图。为了开始，我们不用标准的只视图，在这里我们修改<em>TextView</em>和<em>ImageView</em>，然后将要触发更新状态的的子视图在其容器视图里面更新。我们第一个updateable视图是<em>WeatherImage</em>，只是简单的继承了<code>ImageView</code>并实现了<code>Updateable</code>接口。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherImage</span> <span class="keyword">extends</span> <span class="title">ImageView</span> <span class="keyword">implements</span> <span class="title">Updateable</span></span></span><br></pre></td></tr></table></figure>
<p>在<code>update</code>方法中，我们检查<code>Weather</code>对象所准备的<em>weatherCondition</em>的数据，并根据数据展示一张图片。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">( Weather weather )</span> </span>&#123;</span><br><span class="line">    Log.e( <span class="string">"WeatherImage"</span>, <span class="string">"update!"</span> );</span><br><span class="line">    <span class="keyword">if</span>( weather == <span class="keyword">null</span> || weather.getWeatherCondition() == <span class="keyword">null</span> )</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>( weather.getWeatherCondition() ) &#123;</span><br><span class="line">        <span class="keyword">case</span> CLOUDY: &#123;</span><br><span class="line">            setImageResource( R.drawable.cloudy );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> FOG: &#123;</span><br><span class="line">            setImageResource( R.drawable.fog );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> LIGHTNING: &#123;</span><br><span class="line">            setImageResource( R.drawable.lightning );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> RAIN: &#123;</span><br><span class="line">            setImageResource( R.drawable.rain );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> SNOW: &#123;</span><br><span class="line">            setImageResource( R.drawable.snow );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> SUN: &#123;</span><br><span class="line">            setImageResource( R.drawable.sun );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们用同样的方法实现了<code>WindWeatherTextView</code>，<code>WeatherTextView</code>和<code>WeatherTemperatureTextView</code>。只是把继承的<em>ImageView</em>改为<em>TextView</em>，如名字所示那样。</p>
<p>真正神奇的地方发生在这个为其他可更新子视图创建的容器<code>UpdateableLinearLayout</code>这里。这个容器同样实现了Updateable接口，然而并不是用于调整自身，而是调用了其他子视图的<code>update</code>方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdateableLinearLayout</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> <span class="keyword">implements</span> <span class="title">Updateable</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">( Weather weather )</span> </span>&#123;</span><br><span class="line">    Log.e(<span class="string">"UpdateableLinearLayout"</span>, <span class="string">"Update!"</span> );</span><br><span class="line">    <span class="keyword">if</span>( weather != <span class="keyword">null</span> &amp;&amp; mUpdateableViews != <span class="keyword">null</span> &amp;&amp; !mUpdateableViews.isEmpty() ) &#123;</span><br><span class="line">        <span class="keyword">for</span>( Updateable view : mUpdateableViews ) &#123;</span><br><span class="line">            view.update( weather );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mUpdateableViews</code>是<em>Updateable</em>对象们的一个列表，为了创建一个完整的列表视图，它通过循环和递归找到<code>UpdateableLinearLayout</code>和其子视图中所有实现了<code>Updateable</code>接口的对象，并填充<code>onFinishInflate()</code>方法中。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onFinishInflate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onFinishInflate();</span><br><span class="line">    mUpdateableViews = findTopLevelUpdateables( <span class="keyword">this</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Updateable&gt; <span class="title">findTopLevelUpdateables</span><span class="params">( ViewGroup view )</span> </span>&#123;</span><br><span class="line">    ArrayList&lt;Updateable&gt; results = <span class="keyword">new</span> ArrayList&lt;Updateable&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> childCount = view.getChildCount();</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++ ) &#123;</span><br><span class="line">        results = findTopLevelUpdateables( view.getChildAt( i ), results );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> ArrayList&lt;Updateable&gt; <span class="title">findTopLevelUpdateables</span><span class="params">( View view,</span><br><span class="line">                                                        ArrayList&lt;Updateable&gt; results )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( ( view <span class="keyword">instanceof</span> ViewGroup ) &amp;&amp; !( view <span class="keyword">instanceof</span> Updateable ) ) &#123;</span><br><span class="line">        ViewGroup viewGroup = (ViewGroup) view;</span><br><span class="line">        <span class="keyword">int</span> childCount = viewGroup.getChildCount();</span><br><span class="line">        <span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++ ) &#123;</span><br><span class="line">            findTopLevelUpdateables( viewGroup.getChildAt( i ), results );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Updateable result = ( view != <span class="keyword">null</span> &amp;&amp; view <span class="keyword">instanceof</span> Updateable ) ? (Updateable) view : <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>( result != <span class="keyword">null</span> ) &#123;</span><br><span class="line">        results.add( result );</span><br><span class="line">    &#125;</span><br><span class="line">    results.trimToSize();</span><br><span class="line">    <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的方法可以很容易的用到<code>RelativeLayout</code>或者任何其他的<code>ViewGroup</code>中。</p>
<p>一旦我们的类都创建好了，我们可以把他们放到用户的布局文件中，如下面的<code>activity_main.xml</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;com.ptrprograms.eventdrivenhierarchicalviews.view.UpdateableLinearLayout</span><br><span class="line">    xmlns:android="http://schemas.android.com/apk/res/android"</span><br><span class="line">    android:id="@+id/root"</span><br><span class="line">    android:layout_width="match_parent"</span><br><span class="line">    android:layout_height="match_parent"</span><br><span class="line">    android:orientation="vertical"&gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.ptrprograms.eventdrivenhierarchicalviews.view.WeatherImage</span><br><span class="line">        android:layout_width="match_parent"</span><br><span class="line">        android:layout_height="300dp" /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.ptrprograms.eventdrivenhierarchicalviews.view.WeatherTextView</span><br><span class="line">        android:layout_width="match_parent"</span><br><span class="line">        android:layout_height="wrap_content"</span><br><span class="line">        android:textSize="24sp" /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.ptrprograms.eventdrivenhierarchicalviews.view.WeatherTemperatureTextView</span><br><span class="line">        android:layout_width="match_parent"</span><br><span class="line">        android:layout_height="wrap_content"</span><br><span class="line">        android:textSize="24sp" /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;com.ptrprograms.eventdrivenhierarchicalviews.view.WindWeatherTextView</span><br><span class="line">        android:layout_width="match_parent"</span><br><span class="line">        android:layout_height="wrap_content"</span><br><span class="line">        android:textSize="24sp" /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/com.ptrprograms.eventdrivenhierarchicalviews.view.UpdateableLinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>如你所视，在这个布局中，<code>UpdateableLinearLayout</code>是我们的根ViewGroup，它所有的子View都是实现了<code>Updateable</code>接口的。然而你也可以使用那些没有实现<code>Updateable</code>的View，只是当数据改变的时候他们不会自动更新。</p>
<p>在这个例子中，我们使用<code>UpdateableLinearLayout</code>声明该布局，并在<em>MainActivity</em>的<code>onCreate</code>方法中初始化：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">setContentView(R.layout.activity_main);</span><br><span class="line">mRootView = (UpdateableLinearLayout) findViewById( R.id.root );</span><br></pre></td></tr></table></figure>
<p>在这里，我们没有使用一个活动的API来驱动我们的数据，只是简单的创建了一个方法来模拟每三秒产生一个随机的<code>Weather</code>数据。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startSimulation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mHandler = <span class="keyword">new</span> Handler();</span><br><span class="line">    Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>( mCurrentItem &gt;= mWeather.size() )</span><br><span class="line">                mCurrentItem = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            mRootView.update( mWeather.get( mCurrentItem++ ) );</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>( mHandler != <span class="keyword">null</span> )</span><br><span class="line">                mHandler.postDelayed( <span class="keyword">this</span>, <span class="number">3000</span> );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    runnable.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，我们就有个由数据驱动的自定义视图。并可以在不同的地方建立多个布局文件重复使用这些自定义视图。这个技术在我日常开发中价值不可估量，我希望它对其他的安卓开发者同样有用。</p>
<p><img src="http://treizeor.qiniudn.com/img/ddhv1.png" alt=""></p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/01/04/android-material-design-01/">
  <time datetime="2015-01-04T07:00:00.000Z">
    2015-01-04
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/01/04/android-material-design-01/">Material实践Toolbar和DrawerLayout的使用</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h3 id="设置Theme及定义基本颜色">设置Theme及定义基本颜色</h3><p>根据官方设计规范(<a href="http://www.google.com/design/spec/style/color.html#color-ui-color-application" target="_blank" rel="external"><strong>Color</strong></a>)，定义一些用到的颜色:</p>
<blockquote>
<p>Toolbars and larger color blocks should use the primary <strong>500</strong> color, which should be the main color of your app. The status bar should be the darker <strong>700</strong> tint of your primary color.</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--values/colors.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">color</span> <span class="attribute">name</span>=<span class="value">"color_primary"</span>&gt;</span>#3F51B5<span class="tag">&lt;/<span class="title">color</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">color</span> <span class="attribute">name</span>=<span class="value">"color_primary_dark"</span>&gt;</span>#303F9F<span class="tag">&lt;/<span class="title">color</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">color</span> <span class="attribute">name</span>=<span class="value">"color_accent"</span>&gt;</span>#E91E63<span class="tag">&lt;/<span class="title">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对Lollipop及以下的安卓版本使用不同的styles.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- values/styles.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Base application theme. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"AppTheme.Base"</span>&gt;</span><span class="css"></span><br><span class="line">        &lt;!<span class="tag">--</span> <span class="tag">Customize</span> <span class="tag">your</span> <span class="tag">theme</span> <span class="tag">here</span>. <span class="tag">--</span>&gt;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme.Base"</span> <span class="attribute">parent</span>=<span class="value">"Theme.AppCompat.NoActionBar"</span>&gt;</span><span class="css"></span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">colorPrimary</span>"&gt;<span class="at_rule">@<span class="keyword">color/color_primary&lt;/item&gt;</span></span><br><span class="line">        &lt;item name=<span class="string">"colorPrimaryDark"</span>&gt;@color/color_primary_dark&lt;/item&gt;</span><br><span class="line">        &lt;item name=<span class="string">"colorAccent"</span>&gt;@color/color_accent&lt;/item&gt;</span><br><span class="line">    </span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- values-v21/styles.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"AppTheme.Base"</span>&gt;</span><span class="css"></span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">android</span><span class="pseudo">:colorPrimary"</span>&gt;<span class="at_rule">@<span class="keyword">color/color_primary&lt;/item&gt;</span></span><br><span class="line">        &lt;item name=<span class="string">"android:colorPrimaryDark"</span>&gt;@color/color_primary_dark&lt;/item&gt;</span><br><span class="line">        &lt;item name=<span class="string">"android:colorAccent"</span>&gt;@color/color_accent&lt;/item&gt;</span><br><span class="line">    </span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="使用Toolbar代替ActionBar">使用Toolbar代替ActionBar</h3><ol>
<li>使用<strong>Theme.AppCompat.NoActionBar</strong>或者<strong>Theme.AppCompat.Light.NoActionBar</strong>将系统的ActonBar隐藏</li>
<li>定义一个<strong>app_bar.xml</strong>的布局文件，里面包含一个<strong>ToolBar</strong>控件</li>
<li>使用<strong><include></include></strong>在你的layout中添加Toolbar</li>
<li>Activity中使用<strong>findViewById</strong>实例化Toolbar</li>
<li>使用<strong>setSupportActionBar()</strong>引入实例化的Toolbar</li>
<li>自定义<strong>app:theme</strong>和<strong>app:popupTheme</strong>，如果有需要的话</li>
<li>自定义其他特性，直接使用Toobar的实例或者使用<strong>getSupportActionBar()</strong></li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- layout/app_bar.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">android.support.v7.widget.Toolbar</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"?attr/actionBarSize"</span></span><br><span class="line">    <span class="attribute">android:background</span>=<span class="value">"?attr/colorPrimary"</span></span><br><span class="line">    <span class="attribute">app:popupTheme</span>=<span class="value">"@style/ThemeOverlay.AppCompat.Light"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">android.support.v7.widget.Toolbar</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!-- activity_main.xml --&gt;</span><br><span class="line">&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"</span><br><span class="line">    xmlns:tools="http://schemas.android.com/tools"</span><br><span class="line">    android:layout_width="match_parent"</span><br><span class="line">    android:layout_height="match_parent"</span><br><span class="line">    tools:context=".MainActivity"&gt;</span><br><span class="line"></span><br><span class="line">    &lt;include</span><br><span class="line">        layout="@layout/app_bar"</span><br><span class="line">        android:id="@+id/app_bar" /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width="match_parent"</span><br><span class="line">        android:layout_height="match_parent"</span><br><span class="line">        android:background="#fff"</span><br><span class="line">        android:layout_below="@id/app_bar"&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure>
<p>在<strong>onCreate</strong>方法中实例化<strong>Toolbar</strong>对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Toolbar toolbar;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        toolbar = (Toolbar) findViewById(R.id.app_bar);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>看看效果:</p>
<p><img src="http://treizeor.qiniudn.com/img/material_design_toolbar_1.png" alt=""></p>
<h3 id="使用Navigation_Drawer侧滑菜单">使用Navigation Drawer侧滑菜单</h3><ol>
<li>使用<strong>DrawerLayout</strong>包含两个子布局，一个是你的内容主布局，一个是侧边布局</li>
<li>在代码中初始化<strong>DrawerLayout</strong></li>
<li>创建一个<strong>ActionBarDrawerToggle</strong>的实例，并指定Activity、DrawerLayout、Toolbar、Open和Close的字符串值</li>
<li>使用<strong>ActionBarDrawerToggle</strong>的<strong>syncState()</strong>方法同步汉堡菜单</li>
</ol>
<p>创建一个空的Fragment<code>NavigationDrawerFragment</code>作为侧边栏的布局，修改主布局文件，使用DrawerLayout包含两个子布局:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!-- activity_main.xml --&gt;</span><br><span class="line">&lt;android.support.v4.widget.DrawerLayout xmlns:android="http://schemas.android.com/apk/res/android"</span><br><span class="line">    xmlns:tools="http://schems.android.com/tools"</span><br><span class="line">    xmlns:app="http://schemas.android.com/apk/res-auto"</span><br><span class="line">    android:id="@+id/drawer_layout"</span><br><span class="line">    android:layout_width="match_parent"</span><br><span class="line">    android:layout_height="match_parent"&gt;</span><br><span class="line"></span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:layout_width="match_parent"</span><br><span class="line">        android:layout_height="match_parent"</span><br><span class="line">        tools:context=".MainActivity"&gt;</span><br><span class="line"></span><br><span class="line">        &lt;include</span><br><span class="line">            layout="@layout/app_bar"</span><br><span class="line">            android:id="@+id/app_bar" /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;FrameLayout</span><br><span class="line">            android:layout_width="match_parent"</span><br><span class="line">            android:layout_height="match_parent"</span><br><span class="line">            android:background="#fff"</span><br><span class="line">            android:layout_below="@id/app_bar"&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/FrameLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;fragment</span><br><span class="line">        android:id="@+id/fragment_navigation_drawer"</span><br><span class="line">        android:layout_width="280dp"</span><br><span class="line">        android:layout_gravity="start"</span><br><span class="line">        android:layout_height="match_parent"</span><br><span class="line">        app:layout="@layout/fragment_navigation_drawer"</span><br><span class="line">        tools:layout="@layout/fragment_navigation_drawer"</span><br><span class="line">        android:name="cn.treize.formaterialtest.NavigationDrawerFragment" /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/android.support.v4.widget.DrawerLayout&gt;</span><br></pre></td></tr></table></figure>
<p>在<strong>MainActivity.java</strong>中:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    toolbar = (Toolbar) findViewById(R.id.app_bar);</span><br><span class="line">    setSupportActionBar(toolbar);</span><br><span class="line"></span><br><span class="line">    NavigationDrawerFragment drawerFragment = (NavigationDrawerFragment)</span><br><span class="line">            getSupportFragmentManager().findFragmentById(R.id.fragment_navigation_drawer);</span><br><span class="line">    drawerFragment.setUp((DrawerLayout)findViewById(R.id.drawer_layout), toolbar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改<strong>NavigationDrawerFragment.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.treize.formaterialtest;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.app.Fragment;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.widget.DrawerLayout;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.ActionBarDrawerToggle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.widget.Toolbar;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * A simple &#123;<span class="doctag">@link</span> Fragment&#125; subclass.</span><br><span class="line"> * 注意import的是v4里面的Fragment</span><br><span class="line"> * import android.support.v4.app.Fragment;</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NavigationDrawerFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ActionBarDrawerToggle mDrawerToggle;</span><br><span class="line">    <span class="keyword">private</span> DrawerLayout mDrawerLayout;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NavigationDrawerFragment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Required empty public constructor</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">                             Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the layout for this fragment</span></span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_navigation_drawer, container, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">(DrawerLayout drawerlayout, Toolbar toolbar)</span> </span>&#123;</span><br><span class="line">        mDrawerLayout = drawerlayout;</span><br><span class="line">        mDrawerToggle = <span class="keyword">new</span> ActionBarDrawerToggle(getActivity(),</span><br><span class="line">                drawerlayout,toolbar,R.string.drawer_open,R.string.drawer_close)&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawerOpened</span><span class="params">(View drawerView)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.onDrawerOpened(drawerView);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawerClosed</span><span class="params">(View drawerView)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.onDrawerClosed(drawerView);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        mDrawerLayout.setDrawerListener(mDrawerToggle);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// syncState同步汉堡菜单</span></span><br><span class="line">        drawerlayout.post(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                mDrawerToggle.syncState();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>NavigationDrawerFragment的布局文件，这里只是个空的示例:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!-- fragment_navigation_drawer.xml --&gt;</span><br><span class="line">&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"</span><br><span class="line">    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"</span><br><span class="line">    android:layout_height="match_parent"</span><br><span class="line">    android:background="#CCC"</span><br><span class="line">    tools:context="cn.treize.formaterialtest.NavigationDrawerFragment"&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- TODO: Update blank fragment layout --&gt;</span><br><span class="line">    &lt;TextView android:layout_width="match_parent" android:layout_height="match_parent"</span><br><span class="line">        android:text="@string/hello_blank_fragment" /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/FrameLayout&gt;</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p><code>strings.xml</code>中定义<strong>ActonBarDrawerToggle</strong>的Open和Close字符值:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">string</span> <span class="attribute">name</span>=<span class="value">"drawer_open"</span>&gt;</span>Open<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">string</span> <span class="attribute">name</span>=<span class="value">"drawer_close"</span>&gt;</span>Close<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>看看效果:</p>
<p><img src="http://treizeor.qiniudn.com/img/material_design_drawerlayout_1.png" alt=""></p>
<p>可以看到侧滑菜单遮住了Toolbar，如果我想要另一种效果呢，也就是侧滑菜单在Toolbar下面。方法很简单，把Toobar的layout和drawerlayout放到同级布局文件里面即可。下面创建一个新的布局：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- activity_main_appbar.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span></span><br><span class="line">    <span class="attribute">xmlns:app</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">include</span></span><br><span class="line">        <span class="attribute">layout</span>=<span class="value">"@layout/app_bar"</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/app_bar"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">android.support.v4.widget.DrawerLayout</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/drawer_layout"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">RelativeLayout</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="title">FrameLayout</span></span><br><span class="line">                <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">                <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">                <span class="attribute">android:background</span>=<span class="value">"#fff"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="title">FrameLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="title">RelativeLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">fragment</span></span><br><span class="line">            <span class="attribute">android:id</span>=<span class="value">"@+id/fragment_navigation_drawer"</span></span><br><span class="line">            <span class="attribute">android:layout_width</span>=<span class="value">"280dp"</span></span><br><span class="line">            <span class="attribute">android:layout_gravity</span>=<span class="value">"start"</span></span><br><span class="line">            <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">            <span class="attribute">app:layout</span>=<span class="value">"@layout/fragment_navigation_drawer"</span></span><br><span class="line">            <span class="attribute">tools:layout</span>=<span class="value">"@layout/fragment_navigation_drawer"</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">"cn.treize.formaterialtest.NavigationDrawerFragment"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在MainActivity中引用该布局，看看效果:</p>
<p><img src="http://treizeor.qiniudn.com/img/material_design_drawerlayout_2.png" alt=""></p>
<p>我们看到有些应用在侧边栏展开的时候，Toobar会逐渐变暗，这个效果只需要在ActonBarDrawerToggle实例中实现该方法就行了:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawerSlide</span><span class="params">(View drawerView, <span class="keyword">float</span> slideOffset)</span> </span>&#123;</span><br><span class="line">               <span class="keyword">super</span>.onDrawerSlide(drawerView, slideOffset);</span><br><span class="line">               <span class="keyword">if</span> (slideOffset &lt; <span class="number">0.6</span>) &#123;</span><br><span class="line">                   toolbar.setAlpha(<span class="number">1</span> - slideOffset);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure>
<p>效果也是杠杠的：</p>
<p><img src="http://treizeor.qiniudn.com/img/material_design_drawerlayout_3.png" alt=""></p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2015/01/03/create-floating-action-button-on-android/">
  <time datetime="2015-01-03T07:00:00.000Z">
    2015-01-03
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2015/01/03/create-floating-action-button-on-android/">Android悬浮按钮Floating Action Button</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>Android 5.0中引入了一个很多新的设计，其中有一个是悬浮按钮Floating action button的规范，具体规范可以看这里<a href="http://www.google.com/design/spec/components/buttons.html#buttons-flat-raised-buttons" target="_blank" rel="external"><em>Button</em></a>。</p>
<p>网上有很多实现方法，不过最简单的还是使用<code>ImageButton</code>，今天就来实现下。</p>
<p>根据设计规范:</p>
<p><img src="http://treizeor.qiniudn.com/img/Screenshot from 2015-01-03 21:37:38.png" alt=""></p>
<p>我们先在文件<code>res/values/dimens.xml</code>中定义一些用到的值:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">dimen</span> <span class="attribute">name</span>=<span class="value">"btn_fab_size"</span>&gt;</span>56dp<span class="tag">&lt;/<span class="title">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">dimen</span> <span class="attribute">name</span>=<span class="value">"btn_fab_margin"</span>&gt;</span>16dp<span class="tag">&lt;/<span class="title">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">dimen</span> <span class="attribute">name</span>=<span class="value">"default_elevation"</span>&gt;</span>8dp<span class="tag">&lt;/<span class="title">dimen</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后在布局文件中使用<code>ImageButton</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ImageButton</span></span><br><span class="line">     <span class="attribute">android:id</span>=<span class="value">"@+id/btnFAB"</span></span><br><span class="line">     <span class="attribute">android:layout_width</span>=<span class="value">"@dimen/btn_fab_size"</span></span><br><span class="line">     <span class="attribute">android:layout_height</span>=<span class="value">"@dimen/btn_fab_size"</span></span><br><span class="line">     <span class="attribute">android:layout_alignParentBottom</span>=<span class="value">"true"</span></span><br><span class="line">     <span class="attribute">android:layout_marginBottom</span>=<span class="value">"@dimen/btn_fab_margin"</span></span><br><span class="line">     <span class="attribute">android:layout_marginRight</span>=<span class="value">"@dimen/btn_fab_margin"</span></span><br><span class="line">     <span class="attribute">android:src</span>=<span class="value">"@drawable/ic_add_white_24dp"</span></span><br><span class="line">     <span class="attribute">android:background</span>=<span class="value">"@drawable/btn_fab_default"</span></span><br><span class="line">     <span class="attribute">android:elevation</span>=<span class="value">"@dimen/default_elevation"</span></span><br><span class="line">     <span class="attribute">android:layout_alignParentRight</span>=<span class="value">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中src图标建议在Google的开源图标库<a href="https://github.com/google/material-design-icons" target="_blank" rel="external"><strong>material-design-icons</strong></a>下载。</p>
<p>为了适配v21和v21以下的版本，分别创建<code>res/drawable-v21/btn_fab_default.xml</code>用于适配5.0和<code>res/drawable/btn_fab_default.xml</code>用于适配5.0以下的安卓版本。因为5.0以下无法使用<code>elevation</code>这个新特性。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- drawable-v21/btn_fab_default.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">ripple</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">android:color</span>=<span class="value">"@color/fab_color_shadow"</span></span><br><span class="line">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">shape</span> <span class="attribute">android:shape</span>=<span class="value">"oval"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">solid</span> <span class="attribute">android:color</span>=<span class="value">"@color/style_color_accent"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">shape</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">ripple</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- drawalbe/btn_fab_default.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">selector</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:state_pressed</span>=<span class="value">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:bottom</span>=<span class="value">"0dp"</span> <span class="attribute">android:left</span>=<span class="value">"2dp"</span> <span class="attribute">android:top</span>=<span class="value">"2dp"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">shape</span> <span class="attribute">android:shape</span>=<span class="value">"oval"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">solid</span> <span class="attribute">android:color</span>=<span class="value">"@color/fab_color_shadow"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">shape</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:bottom</span>=<span class="value">"2dp"</span> <span class="attribute">android:left</span>=<span class="value">"2dp"</span> <span class="attribute">android:right</span>=<span class="value">"2dp"</span> <span class="attribute">android:top</span>=<span class="value">"2dp"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">shape</span> <span class="attribute">android:shape</span>=<span class="value">"oval"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">solid</span> <span class="attribute">android:color</span>=<span class="value">"@color/style_color_accent"</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">shape</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">layer-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="title">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:state_pressed</span>=<span class="value">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">shape</span> <span class="attribute">android:bottom</span>=<span class="value">"2dp"</span> <span class="attribute">android:left</span>=<span class="value">"2dp"</span> <span class="attribute">android:right</span>=<span class="value">"2dp"</span> <span class="attribute">android:shape</span>=<span class="value">"oval"</span> <span class="attribute">android:top</span>=<span class="value">"2dp"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">solid</span> <span class="attribute">android:color</span>=<span class="value">"@color/fab_color_pressed"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">shape</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中上面有用到一些颜色值，定义如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- values/colors.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- fab背景颜色 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">color</span> <span class="attribute">name</span>=<span class="value">"style_color_accent"</span>&gt;</span>#01bcd5<span class="tag">&lt;/<span class="title">color</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">color</span> <span class="attribute">name</span>=<span class="value">"fab_color_pressed"</span>&gt;</span>#007787<span class="tag">&lt;/<span class="title">color</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">color</span> <span class="attribute">name</span>=<span class="value">"fab_color_shadow"</span>&gt;</span>#44000000<span class="tag">&lt;/<span class="title">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样就完成了，运行一下看看效果：</p>
<p><img src="http://treizeor.qiniudn.com/img/fab_lollipop.png" alt=""></p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2014/12/08/andorid-baidumap-api-learning2/">
  <time datetime="2014-12-08T07:00:00.000Z">
    2014-12-08
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2014/12/08/andorid-baidumap-api-learning2/">Android百度地图SDK图层</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h3 id="准备工作">准备工作</h3><p>其实也没什么需要准备的，无非下载<a href="http://developer.baidu.com/map/index.php?title=androidsdk/sdkandev-download" target="_blank" rel="external"><strong>SDK</strong></a>和申请<a href="http://lbsyun.baidu.com/apiconsole/key" target="_blank" rel="external"><strong>KEY</strong></a>.话说，百度的SDK<a href="http://developer.baidu.com/map/index.php?title=androidsdk/guide/introduction" target="_blank" rel="external"><strong>开发指南</strong></a>虽然没有详细到每行代码都打出来，不过也足够详细了。所以想了解细节的话还是去看开发指南好点。这里只是简单记录下学习的过程。</p>
<h3 id="代码清单">代码清单</h3><p>AndroidManifest.xml</p>
<p>声明权限</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.GET_ACCOUNTS"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.USE_CREDENTIALS"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.MANAGE_ACCOUNTS"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.AUTHENTICATE_ACCOUNTS"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.INTERNET"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"com.android.launcher.permission.READ_SETTINGS"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.CHANGE_WIFI_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.READ_PHONE_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.BROADCAST_STICKY"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.WRITE_SETTINGS"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.READ_PHONE_STATE"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>在<code>application</code>标签中设置AccessKey</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">meta-data</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">"com.baidu.lbsapi.API_KEY"</span></span><br><span class="line">            <span class="attribute">android:value</span>=<span class="value">"key"</span> /&gt;</span> </span><br><span class="line">            <span class="comment">&lt;!-- key:开发者申请的key,即准备工作中的密钥ak --&gt;</span></span><br></pre></td></tr></table></figure>
<p>菜单menu.xml</p>
<p>为了方便，我把各种功能的实现都放到了菜单里</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">menu</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span></span><br><span class="line">    <span class="attribute">tools:context</span>=<span class="value">"com.example.baidumaptest.MainActivity"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/map_type_satellite"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"never"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"卫星地图"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/set_traffic_enable"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"never"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"交通图"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/set_baiduheatmap_enable"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"never"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"百度城市热力图"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/set_self_heatmap"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"never"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"构建自有热力图"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/polygon_options"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"never"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"几何图形覆盖物"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/text_options"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"never"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"文字覆盖物"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/pop_options"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"never"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"弹出窗覆盖物"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/groud_overlay"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"never"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"地形图图层"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/baidumap_clear"</span></span><br><span class="line">        <span class="attribute">android:orderInCategory</span>=<span class="value">"100"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"never"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"清除标注及覆盖物"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">        <span class="attribute">android:icon</span>=<span class="value">"@drawable/icon_marka"</span></span><br><span class="line">        <span class="attribute">android:showAsAction</span>=<span class="value">"always"</span></span><br><span class="line">        <span class="attribute">android:title</span>=<span class="value">"标注覆盖物"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">menu</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">                <span class="attribute">android:id</span>=<span class="value">"@+id/marker_clear"</span></span><br><span class="line">                <span class="attribute">android:title</span>=<span class="value">"清除标注"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">item</span></span><br><span class="line">                <span class="attribute">android:id</span>=<span class="value">"@+id/marker_reset"</span></span><br><span class="line">                <span class="attribute">android:title</span>=<span class="value">"重置标注"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">menu</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<p>主要还是在各种图层和覆盖物的应用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.baidumaptest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.SDKInitializer;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.BaiduMap;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.BitmapDescriptor;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.BitmapDescriptorFactory;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.Gradient;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.GroundOverlayOptions;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.HeatMap;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.InfoWindow;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.MapView;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.Marker;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.MarkerOptions;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.OverlayOptions;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.PolygonOptions;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.Stroke;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.map.TextOptions;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.model.LatLng;</span><br><span class="line"><span class="keyword">import</span> com.baidu.mapapi.model.LatLngBounds;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	MapView mMapView = <span class="keyword">null</span>;</span><br><span class="line">	BaiduMap mBaiduMap = <span class="keyword">null</span>;</span><br><span class="line">	Marker marker;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		<span class="comment">// 在使用SDK各组件前初始化context信息，需要在setContentView前实现</span></span><br><span class="line">		SDKInitializer.initialize(getApplicationContext());</span><br><span class="line">		setContentView(R.layout.activity_main);</span><br><span class="line">		mMapView = (MapView) findViewById(R.id.bmapView);</span><br><span class="line">		mBaiduMap = mMapView.getMap();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">super</span>.onDestroy();</span><br><span class="line">		mMapView.onDestroy();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onPause();</span><br><span class="line">		mMapView.onPause();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onResume();</span><br><span class="line">		mMapView.onResume();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">		getMenuInflater().inflate(R.menu.main, menu);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">		<span class="keyword">case</span> R.id.map_type_satellite:</span><br><span class="line">			<span class="comment">// 卫星地图</span></span><br><span class="line">			mBaiduMap.setMapType(BaiduMap.MAP_TYPE_SATELLITE);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> R.id.set_traffic_enable:</span><br><span class="line">			<span class="comment">// 交通图</span></span><br><span class="line">			mBaiduMap.setTrafficEnabled(<span class="keyword">true</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> R.id.set_baiduheatmap_enable:</span><br><span class="line">			<span class="comment">// 百度城市热力图</span></span><br><span class="line">			mBaiduMap.setBaiduHeatMapEnabled(<span class="keyword">true</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> R.id.marker_reset:</span><br><span class="line">			<span class="keyword">if</span> (marker != <span class="keyword">null</span>) &#123;</span><br><span class="line">				marker.remove();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 定义Marker坐标点</span></span><br><span class="line">			LatLng point = <span class="keyword">new</span> LatLng(<span class="number">39.963175</span>, <span class="number">116.400244</span>);</span><br><span class="line">			<span class="comment">// 构建Marker图标</span></span><br><span class="line">			BitmapDescriptor bitmap = BitmapDescriptorFactory</span><br><span class="line">					.fromResource(R.drawable.icon_marka);</span><br><span class="line">			<span class="comment">// 构建MarkerOption，用于在地图上添加Marker</span></span><br><span class="line">			OverlayOptions option = <span class="keyword">new</span> MarkerOptions().position(point) <span class="comment">// 设置marker位置</span></span><br><span class="line">					.icon(bitmap) <span class="comment">// 设置marker图标</span></span><br><span class="line">					.zIndex(<span class="number">9</span>) <span class="comment">// 设置marker所在层级</span></span><br><span class="line">					.draggable(<span class="keyword">true</span>); <span class="comment">// 设置可手势拖拽</span></span><br><span class="line">			<span class="comment">// 在地图上添加Marker,并显示</span></span><br><span class="line">			marker = (Marker) mBaiduMap.addOverlay(option);</span><br><span class="line"></span><br><span class="line">			mBaiduMap</span><br><span class="line">					.setOnMarkerClickListener(<span class="keyword">new</span> BaiduMap.OnMarkerClickListener() &#123;</span><br><span class="line"></span><br><span class="line">						<span class="annotation">@Override</span></span><br><span class="line">						<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMarkerClick</span><span class="params">(Marker marker)</span> </span>&#123;</span><br><span class="line">							showPopOptions(marker.getPosition());</span><br><span class="line">							<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 调用BaiduMap对象的setOnMarkerDragListener方法设置marker拖拽到监听</span></span><br><span class="line">			mBaiduMap</span><br><span class="line">					.setOnMarkerDragListener(<span class="keyword">new</span> BaiduMap.OnMarkerDragListener() &#123;</span><br><span class="line"></span><br><span class="line">						<span class="annotation">@Override</span></span><br><span class="line">						<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMarkerDragStart</span><span class="params">(Marker marker)</span> </span>&#123;</span><br><span class="line">							<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">							System.out.println(<span class="string">"--拖拽开始--"</span>);</span><br><span class="line">							Toast.makeText(getApplicationContext(), <span class="string">"拖拽开始"</span>,</span><br><span class="line">									Toast.LENGTH_LONG).show();</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">						<span class="annotation">@Override</span></span><br><span class="line">						<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMarkerDragEnd</span><span class="params">(Marker marker)</span> </span>&#123;</span><br><span class="line">							<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">							System.out.println(<span class="string">"--拖拽结束--"</span>);</span><br><span class="line"></span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">						<span class="annotation">@Override</span></span><br><span class="line">						<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMarkerDrag</span><span class="params">(Marker marker)</span> </span>&#123;</span><br><span class="line">							<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">							System.out.println(<span class="string">"--拖拽中--"</span>);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> R.id.marker_clear:</span><br><span class="line">			<span class="comment">// 移除标注物</span></span><br><span class="line">			marker.remove();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> R.id.polygon_options:</span><br><span class="line">			<span class="comment">// 定义多边形的五个顶点</span></span><br><span class="line">			LatLng pt1 = <span class="keyword">new</span> LatLng(<span class="number">39.93923</span>, <span class="number">116.357428</span>);</span><br><span class="line">			LatLng pt2 = <span class="keyword">new</span> LatLng(<span class="number">39.91923</span>, <span class="number">116.327428</span>);</span><br><span class="line">			LatLng pt3 = <span class="keyword">new</span> LatLng(<span class="number">39.89923</span>, <span class="number">116.347428</span>);</span><br><span class="line">			LatLng pt4 = <span class="keyword">new</span> LatLng(<span class="number">39.89923</span>, <span class="number">116.367428</span>);</span><br><span class="line">			LatLng pt5 = <span class="keyword">new</span> LatLng(<span class="number">39.91923</span>, <span class="number">116.387428</span>);</span><br><span class="line">			List&lt;LatLng&gt; pts = <span class="keyword">new</span> ArrayList&lt;LatLng&gt;();</span><br><span class="line">			pts.add(pt1);</span><br><span class="line">			pts.add(pt2);</span><br><span class="line">			pts.add(pt3);</span><br><span class="line">			pts.add(pt4);</span><br><span class="line">			pts.add(pt5);</span><br><span class="line">			<span class="comment">// 构建多边形的option对象</span></span><br><span class="line">			OverlayOptions polygonOptions = <span class="keyword">new</span> PolygonOptions().points(pts)</span><br><span class="line">					.stroke(<span class="keyword">new</span> Stroke(<span class="number">5</span>, <span class="number">0xAA00FF00</span>)).fillColor(<span class="number">0xAAFF0000</span>);</span><br><span class="line">			<span class="comment">// 在地图上显示多边形</span></span><br><span class="line">			mBaiduMap.addOverlay(polygonOptions);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> R.id.text_options:</span><br><span class="line">			LatLng textLatLng = <span class="keyword">new</span> LatLng(<span class="number">39.86923</span>, <span class="number">116.397428</span>);</span><br><span class="line">			OverlayOptions textOptions = <span class="keyword">new</span> TextOptions().bgColor(<span class="number">0xAAFFFF00</span>)</span><br><span class="line">					.text(<span class="string">"TREIZE到此一游"</span>).fontColor(<span class="number">0xFFFF0000</span>).fontSize(<span class="number">30</span>)</span><br><span class="line">					.position(textLatLng).rotate(-<span class="number">45</span>); <span class="comment">// 45度的忧桑:)</span></span><br><span class="line">			mBaiduMap.addOverlay(textOptions);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> R.id.pop_options:</span><br><span class="line">			<span class="comment">// 定义用于显示该InfoWindow的坐标点</span></span><br><span class="line">			LatLng pt = <span class="keyword">new</span> LatLng(<span class="number">39.86923</span>, <span class="number">116.397428</span>);</span><br><span class="line">			showPopOptions(pt);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> R.id.groud_overlay:</span><br><span class="line">			<span class="comment">// 定义Ground的显示地理范围</span></span><br><span class="line">			LatLng southwest = <span class="keyword">new</span> LatLng(<span class="number">39.92235</span>, <span class="number">116.380338</span>);</span><br><span class="line">			LatLng northeast = <span class="keyword">new</span> LatLng(<span class="number">39.947246</span>, <span class="number">116.414977</span>);</span><br><span class="line">			LatLngBounds bounds = <span class="keyword">new</span> LatLngBounds.Builder().include(northeast)</span><br><span class="line">					.include(southwest).build();</span><br><span class="line">			<span class="comment">// 定义Ground显示的图片</span></span><br><span class="line">			BitmapDescriptor overlay = BitmapDescriptorFactory</span><br><span class="line">					.fromResource(R.drawable.ground_overlay);</span><br><span class="line">			OverlayOptions overlayOptions = <span class="keyword">new</span> GroundOverlayOptions()</span><br><span class="line">					.positionFromBounds(bounds).image(overlay)</span><br><span class="line">					.transparency(<span class="number">0.8f</span>);</span><br><span class="line">			mBaiduMap.addOverlay(overlayOptions);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> R.id.baidumap_clear:</span><br><span class="line">			mBaiduMap.clear();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 构建自有热力图</span></span><br><span class="line">		<span class="keyword">case</span> R.id.set_self_heatmap:</span><br><span class="line">			<span class="comment">// 设置渐变颜色值</span></span><br><span class="line">			<span class="keyword">int</span>[] DEFAULT_GRADIENT_COLORS = &#123; Color.rgb(<span class="number">102</span>, <span class="number">225</span>, <span class="number">0</span>),</span><br><span class="line">					Color.rgb(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>) &#125;;</span><br><span class="line">			<span class="comment">// 设置渐变颜色起始值</span></span><br><span class="line">			<span class="keyword">float</span>[] DEFAULT_GRADIENT_START_POINTS = &#123; <span class="number">0.2f</span>, <span class="number">1f</span> &#125;;</span><br><span class="line">			<span class="comment">// 构造颜色渐变对象</span></span><br><span class="line">			Gradient gradient = <span class="keyword">new</span> Gradient(DEFAULT_GRADIENT_COLORS,</span><br><span class="line">					DEFAULT_GRADIENT_START_POINTS);</span><br><span class="line">			<span class="comment">// 准备数据</span></span><br><span class="line">			<span class="comment">// 以下数据为随机生成地理位置点，开发者根据自己的实际业务，传入自有位置数据即可</span></span><br><span class="line">			List&lt;LatLng&gt; randomLatLngs = <span class="keyword">new</span> ArrayList&lt;LatLng&gt;();</span><br><span class="line">			Random random = <span class="keyword">new</span> Random();</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">500</span>; i++) &#123;</span><br><span class="line">				<span class="keyword">int</span> rlat = random.nextInt(<span class="number">370000</span>);</span><br><span class="line">				<span class="keyword">int</span> rlng = random.nextInt(<span class="number">370000</span>);</span><br><span class="line">				<span class="keyword">int</span> lat = <span class="number">39780000</span> + rlat;</span><br><span class="line">				<span class="keyword">int</span> lng = <span class="number">116220000</span> + rlng;</span><br><span class="line">				LatLng latLng = <span class="keyword">new</span> LatLng(lat / <span class="number">1E6</span>, lng / <span class="number">1E6</span>);</span><br><span class="line">				randomLatLngs.add(latLng);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 添加、显示热力图</span></span><br><span class="line">			HeatMap heatMap = <span class="keyword">new</span> HeatMap.Builder().data(randomLatLngs)</span><br><span class="line">					.gradient(gradient).build();</span><br><span class="line">			mBaiduMap.addHeatMap(heatMap);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showPopOptions</span><span class="params">(LatLng pt)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 创建InfoWindow展示的View</span></span><br><span class="line">		Button button = <span class="keyword">new</span> Button(getApplicationContext());</span><br><span class="line">		button.setText(<span class="string">"弹出窗"</span>);</span><br><span class="line">		button.setTextColor(<span class="number">0xFFFF0000</span>);</span><br><span class="line">		button.setBackgroundResource(R.drawable.popup);</span><br><span class="line">		<span class="comment">// 定义用于显示该InfoWindow的坐标点</span></span><br><span class="line">		<span class="comment">// LatLng pt = new LatLng(39.86923, 116.397428);</span></span><br><span class="line">		<span class="comment">// 创建InfoWindow，传入View，坐标，偏移量</span></span><br><span class="line">		InfoWindow mInfoWindow = <span class="keyword">new</span> InfoWindow(button, pt, -<span class="number">47</span>);</span><br><span class="line">		<span class="comment">// 显示InfoWindow</span></span><br><span class="line">		mBaiduMap.showInfoWindow(mInfoWindow);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="效果图">效果图</h3><p><img src="http://treizeor.qiniudn.com/img/Screenshot_2014-12-08-17-39-26.png?imageMogr2/thumbnail/!50p" alt="效果图1"><br><img src="http://treizeor.qiniudn.com/img/Screenshot_2014-12-08-17-40-11.png?imageMogr2/thumbnail/!50p" alt="效果图1"></p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2014/12/07/baidumap-sdk-learning/">
  <time datetime="2014-12-07T11:10:34.000Z">
    2014-12-07
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2014/12/07/baidumap-sdk-learning/">百度地图SDK之定位功能</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h3 id="准备工作">准备工作</h3><ul>
<li>获取密钥: 具体步骤看<a href="http://developer.baidu.com/map/wiki/index.php?title=androidsdk/guide/key" target="_blank" rel="external"><strong>这里</strong></a></li>
<li>下载库文件: <a href="http://developer.baidu.com/map/index.php?title=android-locsdk/geosdk-android-download" target="_blank" rel="external"><strong>链接</strong></a></li>
</ul>
<p>事实上，我觉得百度的Android定位SDK<a href="http://developer.baidu.com/map/index.php?title=android-locsdk/guide/v4-2" target="_blank" rel="external"><strong>开发指南</strong></a>已经很详细了。本文中的例子就是根据开发指南写的。</p>
<h3 id="具体实现">具体实现</h3><p>设置<strong>AndroidManifest.xml</strong></p>
<p>在application标签中声明service组件,每个app拥有自己单独的定位service</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;service android:name="com.baidu.location.f" android:enabled="true" android:process=":remote"&gt;</span><br><span class="line">&lt;/service&gt;</span><br></pre></td></tr></table></figure>
<p>声明使用权限</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!-- 这个权限用于进行网络定位 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;!-- 这个权限用于访问GPS定位 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;!-- 用于访问wifi网络信息，wifi信息会用于进行网络定位 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.ACCESS_WIFI_STATE" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;!-- 获取运营商信息，用于支持提供运营商信息相关的接口 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;!-- 这个权限用于获取wifi的获取权限，wifi信息会用来进行网络定位 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.CHANGE_WIFI_STATE" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;!-- 用于读取手机当前的状态 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.READ_PHONE_STATE" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;!-- 写入扩展存储，向扩展卡写入数据，用于写入离线定位数据 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;!-- 访问网络，网络定位需要上网 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;</span><br><span class="line">&lt;!-- SD卡读取权限，用户写入离线定位数据 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.MOUNT_UNMOUNT_FILESYSTEMS" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;!-- 允许应用读取低级别的系统日志文件 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.READ_LOGS" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.MOUNT_UNMOUNT_FILESYSTEMS" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br><span class="line">&lt;!-- 允许应用读取低级别的系统日志文件 --&gt;</span><br><span class="line">&lt;uses-permission android:name="android.permission.READ_LOGS" &gt;</span><br><span class="line">&lt;/uses-permission&gt;</span><br></pre></td></tr></table></figure>
<p>在application中设置AcessKey</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">            android:name=<span class="string">"com.baidu.lbsapi.API_KEY"</span></span><br><span class="line">            android:value=<span class="string">"key"</span> /&gt; </span><br><span class="line">            &lt;!-- key:开发者申请的key,即准备工作中的密钥ak --&gt;</span><br></pre></td></tr></table></figure>
<p>代码实现: <strong>MainActivity.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LocationClient mLocationClient;</span><br><span class="line">    <span class="keyword">public</span> BDLocationListener myListener = <span class="keyword">new</span> MyLocationListener();</span><br><span class="line">    <span class="keyword">public</span> NotifyListener mNotifyListener;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EditText showLocation;</span><br><span class="line">    <span class="keyword">private</span> Button startNotify, stopNotify;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        showLocation = (EditText) findViewById(R.id.showLocation);</span><br><span class="line">        startNotify = (Button) findViewById(R.id.startNotify);</span><br><span class="line">        stopNotify = (Button) findViewById(R.id.stopNotify);</span><br><span class="line">        mLocationClient = <span class="keyword">new</span> LocationClient(getApplicationContext());</span><br><span class="line"></span><br><span class="line">        LocationClientOption option = <span class="keyword">new</span> LocationClientOption();</span><br><span class="line">        option.setLocationMode(LocationMode.Hight_Accuracy); <span class="comment">// 设置定位模式</span></span><br><span class="line">        option.setCoorType(<span class="string">"bd0911"</span>); <span class="comment">// 返回的定位结果是百度经纬度，默认值gcj02</span></span><br><span class="line">        option.setScanSpan(<span class="number">5000</span>); <span class="comment">// 发起定位请求时间间隔为5000ms</span></span><br><span class="line">        option.setIsNeedAddress(<span class="keyword">true</span>); <span class="comment">// 返回的结果包含地址信息</span></span><br><span class="line">        option.setNeedDeviceDirect(<span class="keyword">true</span>); <span class="comment">// 返回定位结果包含手机朝向</span></span><br><span class="line">        option.setOpenGps(<span class="keyword">true</span>); <span class="comment">// 设置打开GPS，默认是不打开的</span></span><br><span class="line">        mLocationClient.setLocOption(option);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册监听器</span></span><br><span class="line">        mLocationClient.registerLocationListener(myListener);</span><br><span class="line">        mLocationClient.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">new</span> Timer().schedule(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="annotation">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">                        <span class="comment">// 每隔3秒请求一次位置信息</span></span><br><span class="line">                        mLocationClient.requestLocation();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="number">0</span>, <span class="number">300</span>);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 位置提醒</span></span><br><span class="line">        startNotify.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                mNotifyListener = <span class="keyword">new</span> NotifyListener();</span><br><span class="line">                <span class="comment">// 4个参数代表要位置提醒的点的坐标，具体含义依次为：纬度，经度，距离范围，坐标系类型(gcj02,gps,bd09,bd09ll)</span></span><br><span class="line">                mNotifyListener.SetNotifyLocation(<span class="number">23.0206</span>, <span class="number">113.0960</span>, <span class="number">3000</span>,</span><br><span class="line">                        <span class="string">"gcj02"</span>);</span><br><span class="line">                <span class="comment">// 注册位置监听提醒</span></span><br><span class="line">                mLocationClient.registerNotify(mNotifyListener);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        stopNotify.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">                mLocationClient.removeNotifyEvent(mNotifyListener);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        mLocationClient.stop();</span><br><span class="line">        mLocationClient.unRegisterLocationListener(myListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocationListener</span> <span class="keyword">implements</span> <span class="title">BDLocationListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceiveLocation</span><span class="params">(BDLocation location)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">            <span class="keyword">if</span> (location == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            sb.append(<span class="string">"time: "</span>);</span><br><span class="line">            sb.append(location.getTime());</span><br><span class="line">            sb.append(<span class="string">"\nerr code: "</span>);</span><br><span class="line">            sb.append(location.getLocType());</span><br><span class="line">            sb.append(<span class="string">"\nlatitude: "</span>);</span><br><span class="line">            sb.append(location.getLatitude());</span><br><span class="line">            sb.append(<span class="string">"\nlongitude: "</span>);</span><br><span class="line">            sb.append(location.getLongitude());</span><br><span class="line">            sb.append(<span class="string">"\nradius: "</span>);</span><br><span class="line">            sb.append(location.getRadius());</span><br><span class="line">            <span class="keyword">if</span> (location.getLocType() == BDLocation.TypeGpsLocation) &#123;</span><br><span class="line">                sb.append(<span class="string">"\nspeed: "</span>);</span><br><span class="line">                sb.append(location.getSpeed());</span><br><span class="line">                sb.append(<span class="string">"\nsatellite: "</span>);</span><br><span class="line">                sb.append(location.getSatelliteNumber());</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (location.getLocType() == BDLocation.TypeNetWorkLocation) &#123;</span><br><span class="line">                sb.append(<span class="string">"\naddr: "</span>);</span><br><span class="line">                sb.append(location.getAddrStr()); <span class="comment">// 获取反地理编码地址</span></span><br><span class="line">                sb.append(<span class="string">"\nprovince: "</span>);</span><br><span class="line">                sb.append(location.getProvince());</span><br><span class="line">                sb.append(<span class="string">"\ncity: "</span>);</span><br><span class="line">                sb.append(location.getCity());</span><br><span class="line">                sb.append(<span class="string">"\ndistrict: "</span>);</span><br><span class="line">                sb.append(location.getDistrict());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// logMsg(sb.toString());</span></span><br><span class="line">            showLocation.setText(sb.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotifyListener</span> <span class="keyword">extends</span> <span class="title">BDNotifyListener</span> </span>&#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNotify</span><span class="params">(BDLocation location, <span class="keyword">float</span> distance)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">            Toast.makeText(</span><br><span class="line">                    getApplicationContext(),</span><br><span class="line">                    <span class="string">"距离"</span> + location.getAddrStr() + String.valueOf(distance)</span><br><span class="line">                            + <span class="string">"米"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果图</p>
<p><img src="http://treizeor.qiniudn.com/img/Screenshot_2014-12-07-15-40-09.png?imageMogr2/thumbnail/!50p" alt="百度定位"></p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2014/12/07/setup-wifi-on-raspi/">
  <time datetime="2014-12-07T07:00:00.000Z">
    2014-12-07
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2014/12/07/setup-wifi-on-raspi/">Raspberry Pi无线网卡配置</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>前段时间入手了一个树莓派，作为个人学习用途等不愧为利器。为了方便在不同场地使用，不用拖着网线和自动接入不同WIFI。一个无线网卡是必须的。针对不同WIFI进行设置也是有必要的。</p>
<p>因此，这里简单记录下配置，主要涉及两个文件：</p>
<p><code>cat /etc/wpa_supplicant/wpa_supplicant.conf</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">update_config=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">        ssid=<span class="string">"your_ssid_1"</span></span><br><span class="line">        scan_ssid=<span class="number">1</span>      <span class="preprocessor"># 隐藏的ssid需要加该字段</span></span><br><span class="line">        psk=<span class="string">"password"</span></span><br><span class="line">        key_mgmt=WPA-PSK <span class="preprocessor"># 加密方式</span></span><br><span class="line">        id_str=<span class="string">"home"</span>    <span class="preprocessor"># 设置标签,在interfaces中会用到</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">        ssid=<span class="string">"your_ssid_2"</span></span><br><span class="line">        psk=<span class="string">"password"</span></span><br><span class="line">        key_mgmt=WPA-PSK</span><br><span class="line">        id_str=<span class="string">"phone"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">        ssid=<span class="string">"your_ssid_3"</span></span><br><span class="line">        psk=<span class="string">"password"</span></span><br><span class="line">        key_mgmt=WPA-PSK</span><br><span class="line">        id_str=<span class="string">"work"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>cat /etc/network/interfaces</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> lo</span><br><span class="line"></span><br><span class="line">iface lo inet loopback</span><br><span class="line">iface eth0 inet dhcp</span><br><span class="line"></span><br><span class="line">allow-hotplug wlan0</span><br><span class="line">iface wlan0 inet manual</span><br><span class="line">wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf</span><br><span class="line"><span class="preprocessor"># iface default inet dhcp</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 对不同的wifi分别设置，可为动态获取或静态</span></span><br><span class="line">iface home inet <span class="keyword">static</span></span><br><span class="line">address <span class="number">192.168</span><span class="number">.3</span><span class="number">.8</span></span><br><span class="line">gateway <span class="number">192.168</span><span class="number">.3</span><span class="number">.1</span></span><br><span class="line">netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">iface phone inet dhcp</span><br><span class="line"></span><br><span class="line">iface work inet <span class="keyword">static</span></span><br><span class="line">address <span class="number">19.128</span><span class="number">.117</span><span class="number">.233</span></span><br><span class="line">gateway <span class="number">19.128</span><span class="number">.117</span><span class="number">.254</span></span><br><span class="line">netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2014/10/13/install-openwrt-on-703n-and-extend-space-with-usb-flash-drive/">
  <time datetime="2014-10-13T11:10:34.000Z">
    2014-10-13
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2014/10/13/install-openwrt-on-703n-and-extend-space-with-usb-flash-drive/">WR703N刷OpenWrt及使用U盘扩容</a></h1>
  

  </header>
  
  <div class="entry">
    
      <h3 id="安装">安装</h3><p>路由器分两种情况，一种是没原厂固件没刷过的，一种是已经刷过需要重刷的。</p>
<ul>
<li>没刷过的话很简单，直接在OpenWrt的<a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n" target="_blank" rel="external"><em>Wiki</em></a>页下载<a href="http://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/generic/openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin" target="_blank" rel="external"><em>squashfs-factory.bin</em></a>，然后进入路由器管理界面更新固件，选择下载的固件更新就可以了</li>
<li>刷过的话则ssh进入路由器(<del>话说既然刷过，那还用看这个吗。最近老感觉什么都没必要写，Google用得太多了的缘故吗</del>)，切换到<code>/tmp</code>目录</li>
</ul>
<p><code>cd /tmp</code></p>
<p>然后wget下载固件</p>
<p><code>wget http://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/generic/openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin</code></p>
<p>完成后用<code>mtd</code>命令刷入</p>
<p><code>mtd -r write openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin firmware</code></p>
<p>刷完会自动重启。</p>
<h3 id="配置">配置</h3><p>电脑用网线直接连接路由器，本地连接IP设为192.168.1.2(<em>2至254都可以</em>)，然后telnet进入<code>192.168.1.1</code>(<em>这是路由器的默认IP</em>)，telnet工具可以用<a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html" target="_blank" rel="external"><strong>putty</strong></a>，如下图:</p>
<p><img src="http://treizeor.qiniudn.com/img/putty_telnet.jpg" alt="putty_telnet"></p>
<p>然后就是修改密码和<del>修改默认IP</del>了(我这里主要拿来接在另一个路由器上面的做下载机和NAS的)</p>
<p>使用命令<code>passwd 新密码</code>进行修改。</p>
<p><code>vi /etc/config/network</code>改路由器IP，增加<code>gateway</code>,<code>dns</code>设置，根据自己的情况修改</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line">config <span class="keyword">interface</span> <span class="comment">'loopback'</span></span><br><span class="line">        <span class="keyword">option</span> ifname <span class="comment">'lo'</span></span><br><span class="line">        <span class="keyword">option</span> proto <span class="comment">'static'</span></span><br><span class="line">        <span class="keyword">option</span> ipaddr <span class="comment">'127.0.0.1'</span></span><br><span class="line">        <span class="keyword">option</span> netmask <span class="comment">'255.0.0.0'</span></span><br><span class="line"></span><br><span class="line">config <span class="keyword">interface</span> <span class="comment">'lan'</span></span><br><span class="line">        <span class="keyword">option</span> ifname <span class="comment">'eth0'</span></span><br><span class="line">        <span class="keyword">option</span> type <span class="comment">'bridge'</span></span><br><span class="line">        <span class="keyword">option</span> proto <span class="comment">'static'</span></span><br><span class="line">        <span class="keyword">option</span> ipaddr <span class="comment">'192.168.3.2'</span></span><br><span class="line">        <span class="keyword">option</span> netmask <span class="comment">'255.255.255.0'</span></span><br><span class="line">        <span class="keyword">option</span> gateway <span class="comment">'192.168.3.1'</span></span><br><span class="line">        <span class="keyword">option</span> dns <span class="comment">'8.8.8.8'</span></span><br></pre></td></tr></table></figure>
<p>OK，<code>reboot</code>并把网线接到路由器上。现在可以<code>ssh</code>进路由器了。</p>
<h3 id="挂载U盘扩容">挂载U盘扩容</h3><p>命令<code>opkg update</code>下载软件包列表</p>
<p>安装几个软件包，因为703N的flash只有4M，没法装太多东西，所以同过U盘扩容可以做更多事。这里只安装几个必要的，实际上在使用U盘之前的还是要分下区，不过最好在电脑上分好。我是接在树莓派上分好的，有3个区，第一个是ext4用来给系统扩容，第二个是swap交换分区，分个64M也就差不多了，事实上这个分区没见用过。第三个就随便了nfs或ext4，我这里是ext4。</p>
<p><code>opkg install block-mount kmod-fs-ext4 kmod-usb-ohci kmod-usb-storage</code></p>
<p>完成后插入U盘看看是否识别<code>ls /dev</code>是否有sda,sda1,sda2,sda3存在</p>
<p>接下来把系统复制到U盘<code>sda1</code>分区依次执行</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">mount <span class="regexp">/dev/</span>sda1 /mnt  </span><br><span class="line">mkdir <span class="regexp">/tmp/</span>root  </span><br><span class="line">mount -o bind <span class="regexp">/ /</span>tmp/root  </span><br><span class="line">cp <span class="regexp">/tmp/</span>root<span class="comment">/* /mnt -a  </span><br><span class="line">umount /tmp/root</span></span><br></pre></td></tr></table></figure>
<p>然后设置好交换空间</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">mkswap <span class="regexp">/dev/</span>sda2  </span><br><span class="line">swapon <span class="regexp">/dev/</span>sda2</span><br></pre></td></tr></table></figure>
<p>最后编辑<code>/etc/config/fstab</code>文件</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">config mount  </span><br><span class="line">        <span class="keyword">option</span> target   /overlay</span><br><span class="line">        <span class="keyword">option</span> device   /dev/sda1</span><br><span class="line">        <span class="keyword">option</span> fstype   ext4</span><br><span class="line">        <span class="keyword">option</span> <span class="keyword">options</span>  rw,sync</span><br><span class="line">        <span class="keyword">option</span> enabled  <span class="number">1</span></span><br><span class="line">        <span class="keyword">option</span> enabled_fsck <span class="number">0</span></span><br><span class="line">config swap  </span><br><span class="line">        <span class="keyword">option</span> device   /dev/sda2</span><br><span class="line">        <span class="keyword">option</span> enabled  <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>重启后，<code>df -h</code>看看空间是否扩大了，<code>sda3</code>会自动挂载到<code>/mnt/sda3</code>的。可以修改<code>/etc/banner</code>区别内置和U盘启动。</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2015 <a href="/">John Doe</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
  var duoshuoQuery = { short_name: 'mindofme' };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>